<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>FEZ Skill Counter</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" href="http://cdn.jsdelivr.net/animatecss/3.1.0/animate.css">
<style type="text/css">
    @import url('https://fonts.googleapis.com/css?family=Noto+Serif+JP');
    body {
        background-color: black;
    }
    tr {
        color    : white;
        font-size: 20px;
    }
    th.shortname {
        text-align: left;
    }
    th.count {
        padding-left: 0.5em;
        text-align  : right;
    }
</style>

<script>
    const skillcount_xml_path = "skillcount.xml";   // スキル使用回数XMLファイルのパス
    const timer_interval_ms   = 100;                // スキル使用回数XMLファイルの監視タイマー周期(ms)

    function start() {
        setInterval(timer_tick, timer_interval_ms);
    }

    function timer_tick() {
        $.ajax({
            url: skillcount_xml_path,
            type: 'GET',
            dataType: 'xml',
            timeout: 5000,
        }).done(function (xml) {
            const table            = $("table");
            const skill_collection = xml.getElementsByTagName('skill');
            for (let skill of skill_collection) {
                const name      = skill.getElementsByTagName("name")[0].textContent;
                const shortname = skill.getElementsByTagName("shortname")[0].textContent;
                const count     = skill.getElementsByTagName("count")[0].textContent;
                const tr        = table.find(`#${name}`);
                if (tr === undefined || tr.length <= 0) {
                    table.append(
                        `<tr id="${name}">` +
                            `<th class="shortname"><div>${shortname}</div></th>` +
                            `<th class="count"><div class="count_value">${count}</div></th>` +
                        `<tr>`);
                }
                else {
                    update_count(tr.find(".count_value"), count);
                }
            }
        });
    }

    function update_count(target, text) {
        if (target.text() != text) {
            target.fadeOut(function() {
                target.html(text);
                target.fadeIn();
            });
        }
    }
</script>
</head>
<body onload="start();">
    <table id="table"></table>
</body>
</html>